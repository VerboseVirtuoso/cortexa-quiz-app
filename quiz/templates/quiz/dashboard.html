{% extends 'quiz/base.html' %}

{% block title %}My Studio | Cortexa{% endblock %}

{% block content %}
<div class="hero">
    <span class="badge">Welcome, {{ user.username }}</span>
    <h1>Your Learning <span class="gradient-text">Studio</span></h1>
    <p>
        Track your progress, challenge yourself with new quizzes, and manage your activity all from one place.
    </p>

    <div class="quiz-grid" style="margin-top: 4rem;">
        <div class="glass-card stat-card">
            <h3 class="gradient-text">{{ quizzes.count }}</h3>
            <p>Quizzes Created</p>
        </div>
        <div class="glass-card stat-card">
            <h3 class="gradient-text">0%</h3>
            <p>Average Score</p>
        </div>
        <div class="glass-card stat-card">
            <h3 class="gradient-text">0</h3>
            <p>Active Streaks</p>
        </div>
    </div>

    <div class="glass-card" style="margin-top: 3rem; text-align: left;">
        <h2 style="margin-bottom: 2rem; font-family: 'Outfit', sans-serif;">Quick Actions</h2>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <a href="{% url 'home' %}" class="btn btn-primary">Browse All Quizzes</a>
            <a href="{% url 'quiz_create' %}" class="btn btn-secondary">+ Create New Quiz</a>
            {% if user.is_staff %}
            <a href="/admin/" class="btn btn-secondary">Admin Panel</a>
            {% endif %}
        </div>
    </div>

    <!-- SECTION 1: My Created Quizzes -->
    <div class="glass-card" style="margin-top: 3rem; text-align: left;">
        <h2 style="margin-bottom: 2rem; font-family: 'Outfit', sans-serif;">My Created <span
                class="gradient-text">Quizzes</span></h2>
        {% if created_quizzes %}
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for quiz in created_quizzes %}
            <div class="glass-card"
                style="padding: 1.5rem; border-radius: var(--radius-md); background: rgba(255,255,255,0.03); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <p style="font-weight: 700; font-size: 1.1rem; color: var(--text-bright);">{{ quiz.title }}</p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">
                        {{ quiz.attempts.count }} attempt{% if quiz.attempts.count != 1 %}s{% endif %} &bull;
                        Average Score: {% if quiz.avg_percentage %}{{ quiz.avg_percentage|floatformat:1 }}%{% else %}0.0%{% endif %}
                    </p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <a href="{% url 'quiz_detail' quiz.pk %}" class="btn btn-secondary"
                        style="padding: 0.4rem 1rem; font-size: 0.85rem;">View</a>
                    <a href="{% url 'add_question' quiz.pk %}" class="btn btn-secondary"
                        style="padding: 0.4rem 1rem; font-size: 0.85rem; border-color: var(--primary-light); color: var(--primary-light);">+
                        Question</a>
                    <a href="{% url 'quiz_update' quiz.pk %}" class="btn btn-secondary"
                        style="padding: 0.4rem 1rem; font-size: 0.85rem;">Edit</a>
                    <a href="{% url 'quiz_delete' quiz.pk %}" class="btn btn-secondary"
                        style="padding: 0.4rem 1rem; font-size: 0.85rem; border-color: rgba(239,68,68,0.3); color: var(--error);">Delete</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem 0; color: var(--text-muted);">
            <p style="font-size: 1.1rem;">You haven't created any quizzes yet.</p>
            <a href="{% url 'quiz_create' %}" class="btn btn-primary"
                style="margin-top: 1.5rem; display: inline-block;">Create Your First Quiz</a>
        </div>
        {% endif %}
    </div>

    <!-- SECTION 2: My Attempts -->
    <div class="glass-card" style="margin-top: 3rem; text-align: left;">
        <h2 style="margin-bottom: 2rem; font-family: 'Outfit', sans-serif;">My <span
                class="gradient-text">Attempts</span></h2>
        {% if user_attempts %}
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for attempt in user_attempts %}
            <div class="glass-card"
                style="padding: 1.5rem; border-radius: var(--radius-md); background: rgba(255,255,255,0.03); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <p style="font-weight: 700; font-size: 1.1rem; color: var(--text-bright);">{{ attempt.quiz.title }}
                    </p>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem;">
                        Score: {{ attempt.score }}/{{ attempt.total_questions }} ({{ attempt.percentage|floatformat:1 }}%) &bull;
                        {{ attempt.created_at|date:"M j, Y, g:i a" }}
                    </p>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <a href="{% url 'quiz_start' attempt.quiz.pk %}" class="btn btn-primary"
                        style="padding: 0.4rem 1rem; font-size: 0.85rem;">Retake Quiz</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem 0; color: var(--text-muted);">
            <p style="font-size: 1.1rem;">You haven't attempted any quizzes yet.</p>
            <a href="{% url 'home' %}" class="btn btn-primary" style="margin-top: 1.5rem; display: inline-block;">Browse
                Quizzes</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}